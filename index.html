<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memórias Educação Visual UL - Universidade Licungo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ul-blue': '#1e88e5',
                        'ul-brown': '#8d6e63',
                        'ul-gold': '#d4af37'
                    }
                }
            }
        }
    </script>
    <style>
        .page { display: none; }
        .page.active { display: block; }
        .image-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
            gap: 12px; 
        }
        .image-item {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .image-item:hover {
            transform: scale(1.05);
        }
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .modal {
            backdrop-filter: blur(10px);
        }
        .upload-area {
            border: 2px dashed #1e88e5;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .upload-area.dragover {
            border-color: #d4af37;
            background-color: rgba(212, 175, 55, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-ul-blue text-white sticky top-0 z-40 shadow-lg">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <img src="https://pfst.cf2.poecdn.net/base/image/5556b804b06b3c61cb958867ebe7b6cc285f6340de2c7660f5493aa5760b298e?w=1280&h=1152" 
                     alt="UL Logo" class="w-10 h-10 rounded-full bg-white p-1">
                <div>
                    <h1 class="text-lg font-bold">Memórias Educação Visual UL</h1>
                    <p class="text-xs opacity-90">Universidade Licungo</p>
                </div>
            </div>
            <button id="menuBtn" class="text-2xl">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Navigation Menu -->
    <nav id="menu" class="fixed top-0 right-0 h-full w-64 bg-white shadow-lg transform translate-x-full transition-transform duration-300 z-50">
        <div class="p-4 bg-ul-blue text-white">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-bold">Menu</h2>
                <button id="closeMenu" class="text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="p-4">
            <ul class="space-y-4">
                <li>
                    <button onclick="showPage('gallery')" class="flex items-center space-x-3 w-full text-left p-3 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-images text-ul-blue"></i>
                        <span>Memórias</span>
                    </button>
                </li>
                <li>
                    <button onclick="showPage('upload')" class="flex items-center space-x-3 w-full text-left p-3 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-cloud-upload-alt text-ul-blue"></i>
                        <span>Upload</span>
                    </button>
                </li>
                <li>
                    <button onclick="showPage('about')" class="flex items-center space-x-3 w-full text-left p-3 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-info-circle text-ul-blue"></i>
                        <span>Sobre</span>
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Menu Overlay -->
    <div id="menuOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <!-- Gallery Page -->
    <div id="gallery" class="page active">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-images text-ul-blue mr-2"></i>
                    Memórias do Curso
                </h2>
                <div class="flex space-x-2">
                    <button onclick="refreshGallery()" class="bg-ul-blue text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button onclick="showPage('upload')" class="bg-ul-gold text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
            
            <div id="loadingGallery" class="text-center py-8">
                <i class="fas fa-spinner fa-spin text-4xl text-ul-blue mb-4"></i>
                <p class="text-gray-600">Carregando imagens...</p>
            </div>
            
            <div id="galleryGrid" class="image-grid hidden"></div>
            
            <div id="emptyGallery" class="text-center py-12 hidden">
                <i class="fas fa-images text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">Nenhuma imagem encontrada</h3>
                <p class="text-gray-500 mb-4">Seja o primeiro a compartilhar uma memória!</p>
                <button onclick="showPage('upload')" class="bg-ul-blue text-white px-6 py-3 rounded-lg">
                    <i class="fas fa-cloud-upload-alt mr-2"></i>
                    Fazer Upload
                </button>
            </div>
        </div>
    </div>

    <!-- Upload Page -->
    <div id="upload" class="page">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center mb-6">
                <button onclick="showPage('gallery')" class="text-ul-blue mr-4 text-2xl">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-cloud-upload-alt text-ul-blue mr-2"></i>
                    Upload de Imagem
                </h2>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <div id="uploadArea" class="upload-area p-8 text-center">
                    <i class="fas fa-cloud-upload-alt text-4xl text-ul-blue mb-4"></i>
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Selecione ou arraste uma imagem</h3>
                    <p class="text-gray-500 mb-4">PNG, JPG, GIF até 100MB</p>
                    <input type="file" id="fileInput" accept="image/*" class="hidden">
                    <button onclick="document.getElementById('fileInput').click()" class="bg-ul-blue text-white px-6 py-3 rounded-lg">
                        <i class="fas fa-folder-open mr-2"></i>
                        Escolher Arquivo
                    </button>
                </div>

                <div id="uploadPreview" class="mt-6 hidden">
                    <h4 class="font-semibold text-gray-700 mb-3">Pré-visualização:</h4>
                    <div class="flex items-start space-x-4">
                        <img id="previewImage" class="w-24 h-24 object-cover rounded-lg">
                        <div class="flex-1">
                            <input type="text" id="imageTitle" placeholder="Título da imagem (opcional)" 
                                   class="w-full p-3 border border-gray-300 rounded-lg mb-3 text-base">
                            <div class="flex space-x-3">
                                <button onclick="uploadImage()" id="uploadBtn" 
                                        class="bg-ul-gold text-white px-6 py-3 rounded-lg flex-1">
                                    <i class="fas fa-upload mr-2"></i>
                                    Enviar
                                </button>
                                <button onclick="cancelUpload()" class="bg-gray-500 text-white px-6 py-3 rounded-lg">
                                    <i class="fas fa-times mr-2"></i>
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="uploadProgress" class="mt-6 hidden">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Enviando...</span>
                        <span id="progressPercent" class="text-sm text-gray-600">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progressBar" class="bg-ul-blue h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- About Page -->
    <div id="about" class="page">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center mb-6">
                <button onclick="showPage('gallery')" class="text-ul-blue mr-4 text-2xl">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-info-circle text-ul-blue mr-2"></i>
                    Sobre a Galeria
                </h2>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 space-y-6">
                <div class="text-center">
                    <img src="https://pfst.cf2.poecdn.net/base/image/5556b804b06b3c61cb958867ebe7b6cc285f6340de2c7660f5493aa5760b298e?w=1280&h=1152" 
                         alt="UL Logo" class="w-24 h-24 mx-auto rounded-full bg-gray-100 p-2 mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Memórias Educação Visual UL</h3>
                    <p class="text-gray-600">Curso de Educação Visual - Universidade Licungo</p>
                </div>

                <div class="border-t pt-6">
                    <h4 class="font-semibold text-gray-800 mb-3">
                        <i class="fas fa-camera text-ul-blue mr-2"></i>
                        Sobre esta aplicação
                    </h4>
                    <p class="text-gray-600 leading-relaxed">
                        Esta plataforma foi desenvolvida para os estudantes e professores do curso de Educação Visual da Universidade Licungo compartilharem 
                        e preservarem memórias de projetos artísticos, exposições, trabalhos acadêmicos e momentos especiais do curso.
                    </p>
                </div>

                <div class="border-t pt-6">
                    <h4 class="font-semibold text-gray-800 mb-3">
                        <i class="fas fa-shield-alt text-ul-blue mr-2"></i>
                        Política de Uso
                    </h4>
                    <ul class="text-gray-600 space-y-2 text-sm">
                        <li>• Apenas imagens relacionadas ao curso de Educação Visual</li>
                        <li>• Respeite os direitos autorais das imagens</li>
                        <li>• Máximo de 100MB por imagem</li>
                        <li>• Formatos aceitos: PNG, JPG, GIF</li>
                    </ul>
                </div>

                <div class="border-t pt-6">
                    <h4 class="font-semibold text-gray-800 mb-3">
                        <i class="fas fa-code text-ul-blue mr-2"></i>
                        Informações Técnicas
                    </h4>
                    <p class="text-gray-600 text-sm">
                        Desenvolvido com tecnologias web modernas e Supabase para armazenamento seguro e confiável.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="relative max-w-4xl w-full">
                <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white text-3xl z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="bg-white rounded-lg overflow-hidden">
                    <img id="modalImage" class="w-full max-h-96 object-contain">
                    <div class="p-4">
                        <h3 id="modalTitle" class="text-lg font-semibold text-gray-800 mb-3"></h3>
                        <div class="flex space-x-3">
                            <button onclick="downloadImage()" class="bg-ul-blue text-white px-6 py-3 rounded-lg flex-1">
                                <i class="fas fa-download mr-2"></i>
                                Baixar
                            </button>
                            <button onclick="shareImage()" class="bg-ul-gold text-white px-6 py-3 rounded-lg">
                                <i class="fas fa-share-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuração do Supabase
        const SUPABASE_URL = 'https://gatkddtomkzcciqhkebt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdhdGtkZHRvbWt6Y2NpcWhrZWJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExMzc5NzEsImV4cCI6MjA2NjcxMzk3MX0.FjnzSOhtz-eO6D_tttHolVo4M36FjlomnYu_qxnfiQ0 ';
        
        // Para demonstração, vamos usar uma simulação
        let supabase = null;
        let images = [];

        // Simulação de dados para demonstração
        const demoImages = [
            {
                id: 1,
                title: 'Campus Principal',
                url: 'https://picsum.photos/400/400?random=1',
                created_at: new Date().toISOString()
            },
            {
                id: 2,
                title: 'Biblioteca',
                url: 'https://picsum.photos/400/400?random=2',
                created_at: new Date().toISOString()
            },
            {
                id: 3,
                title: 'Laboratório',
                url: 'https://picsum.photos/400/400?random=3',
                created_at: new Date().toISOString()
            }
        ];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            initSupabase();
            loadGallery();
            setupEventListeners();
        });

        function initSupabase() {
            try {
                // Em produção, substitua pelas suas credenciais do Supabase
                if (SUPABASE_URL !== 'https://your-project.supabase.co') {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                } else {
                    console.log('Usando dados de demonstração - Configure o Supabase para produção');
                    images = [...demoImages];
                }
            } catch (error) {
                console.error('Erro ao inicializar Supabase:', error);
                images = [...demoImages];
            }
        }

        function setupEventListeners() {
            // Menu
            document.getElementById('menuBtn').addEventListener('click', openMenu);
            document.getElementById('closeMenu').addEventListener('click', closeMenu);
            document.getElementById('menuOverlay').addEventListener('click', closeMenu);

            // Upload
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');

            fileInput.addEventListener('change', handleFileSelect);

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            closeMenu();
            
            if (pageId === 'gallery') {
                loadGallery();
            }
        }

        function openMenu() {
            document.getElementById('menu').classList.remove('translate-x-full');
            document.getElementById('menuOverlay').classList.remove('hidden');
        }

        function closeMenu() {
            document.getElementById('menu').classList.add('translate-x-full');
            document.getElementById('menuOverlay').classList.add('hidden');
        }

        async function loadGallery() {
            const loadingEl = document.getElementById('loadingGallery');
            const gridEl = document.getElementById('galleryGrid');
            const emptyEl = document.getElementById('emptyGallery');

            loadingEl.classList.remove('hidden');
            gridEl.classList.add('hidden');
            emptyEl.classList.add('hidden');

            try {
                if (supabase) {
                    const { data, error } = await supabase
                        .from('images')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    images = data || [];
                } else {
                    // Simulação de delay para demonstração
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                loadingEl.classList.add('hidden');

                if (images.length === 0) {
                    emptyEl.classList.remove('hidden');
                } else {
                    renderGallery();
                    gridEl.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Erro ao carregar galeria:', error);
                loadingEl.classList.add('hidden');
                emptyEl.classList.remove('hidden');
            }
        }

        function renderGallery() {
            const gridEl = document.getElementById('galleryGrid');
            gridEl.innerHTML = '';

            images.forEach(image => {
                const imageEl = document.createElement('div');
                imageEl.className = 'image-item bg-gray-200';
                imageEl.innerHTML = `
                    <img src="${image.url}" alt="${image.title || 'Imagem'}" loading="lazy">
                `;
                imageEl.addEventListener('click', () => openImageModal(image));
                gridEl.appendChild(imageEl);
            });
        }

        function refreshGallery() {
            loadGallery();
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Por favor, selecione apenas arquivos de imagem.');
                return;
            }

            if (file.size > 100 * 1024 * 1024) {
                alert('Arquivo muito grande. Máximo 100MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('uploadPreview').classList.remove('hidden');
                document.getElementById('uploadArea').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        async function uploadImage() {
            const fileInput = document.getElementById('fileInput');
            const titleInput = document.getElementById('imageTitle');
            const uploadBtn = document.getElementById('uploadBtn');
            const progressEl = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');

            if (!fileInput.files[0]) return;

            uploadBtn.disabled = true;
            progressEl.classList.remove('hidden');

            try {
                if (supabase) {
                    // Upload real para Supabase
                    const file = fileInput.files[0];
                    const fileName = `${Date.now()}-${file.name}`;
                    
                    const { data, error } = await supabase.storage
                        .from('images')
                        .upload(fileName, file);

                    if (error) throw error;

                    const { data: urlData } = supabase.storage
                        .from('images')
                        .getPublicUrl(fileName);

                    const { error: dbError } = await supabase
                        .from('images')
                        .insert([{
                            title: titleInput.value || 'Sem título',
                            url: urlData.publicUrl,
                            file_name: fileName
                        }]);

                    if (dbError) throw dbError;
                } else {
                    // Simulação para demonstração
                    await simulateUpload(progressBar, progressPercent);
                    
                    const newImage = {
                        id: Date.now(),
                        title: titleInput.value || 'Nova Memória',
                        url: document.getElementById('previewImage').src,
                        created_at: new Date().toISOString()
                    };
                    images.unshift(newImage);
                }

                // Reset form
                cancelUpload();
                alert('Memória enviada com sucesso!');
                showPage('gallery');
            } catch (error) {
                console.error('Erro no upload:', error);
                alert('Erro ao enviar memória: ' + error.message);
            } finally {
                uploadBtn.disabled = false;
                progressEl.classList.add('hidden');
            }
        }

        async function simulateUpload(progressBar, progressPercent) {
            for (let i = 0; i <= 100; i += 10) {
                await new Promise(resolve => setTimeout(resolve, 100));
                progressBar.style.width = i + '%';
                progressPercent.textContent = i + '%';
            }
        }

        function cancelUpload() {
            document.getElementById('fileInput').value = '';
            document.getElementById('imageTitle').value = '';
            document.getElementById('uploadPreview').classList.add('hidden');
            document.getElementById('uploadArea').style.display = 'block';
        }

        let currentImage = null;

        function openImageModal(image) {
            currentImage = image;
            document.getElementById('modalImage').src = image.url;
            document.getElementById('modalTitle').textContent = image.title || 'Sem título';
            document.getElementById('imageModal').classList.remove('hidden');
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.add('hidden');
            currentImage = null;
        }

        function downloadImage() {
            if (!currentImage) return;

            const link = document.createElement('a');
            link.href = currentImage.url;
            link.download = currentImage.title || 'imagem';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function shareImage() {
            if (!currentImage) return;

            if (navigator.share) {
                navigator.share({
                    title: currentImage.title || 'Memória do Curso de Educação Visual UL',
                    url: currentImage.url
                });
            } else {
                // Fallback para navegadores sem suporte ao Web Share API
                navigator.clipboard.writeText(currentImage.url).then(() => {
                    alert('Link da imagem copiado para a área de transferência!');
                }).catch(() => {
                    alert('Não foi possível compartilhar a imagem.');
                });
            }
        }

        // Fechar modal ao pressionar ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeImageModal();
                closeMenu();
            }
        });
    </script>
</body>
</html>
 